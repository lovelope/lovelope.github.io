<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>硬链接与软链接的联系与区别 | lovelope博客</title>
    <meta name="description" content="种下一棵树的最佳时间不是十年前，而是现在。">
    
    
    <link rel="preload" href="/assets/css/0.styles.83d3ab16.css" as="style"><link rel="preload" href="/assets/js/app.5770203f.js" as="script"><link rel="preload" href="/assets/js/17.51e61b79.js" as="script"><link rel="prefetch" href="/assets/js/3.aff9079f.js"><link rel="prefetch" href="/assets/js/2.673272d7.js"><link rel="prefetch" href="/assets/js/4.a1bc754e.js"><link rel="prefetch" href="/assets/js/5.26cd1ccd.js"><link rel="prefetch" href="/assets/js/6.0af27563.js"><link rel="prefetch" href="/assets/js/7.a5fea5a1.js"><link rel="prefetch" href="/assets/js/8.cd6f4ee1.js"><link rel="prefetch" href="/assets/js/9.0bd568a0.js"><link rel="prefetch" href="/assets/js/10.368d8957.js"><link rel="prefetch" href="/assets/js/11.9f1e6fae.js"><link rel="prefetch" href="/assets/js/12.b8efd0be.js"><link rel="prefetch" href="/assets/js/13.624745ce.js"><link rel="prefetch" href="/assets/js/14.e1387c03.js"><link rel="prefetch" href="/assets/js/15.76fa5cc0.js"><link rel="prefetch" href="/assets/js/16.bcf7569f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.83d3ab16.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">lovelope博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><!---->  <!----> </div> <div class="page"> <div class="content"><h1 id="硬链接与软链接的联系与区别"><a href="#硬链接与软链接的联系与区别" aria-hidden="true" class="header-anchor">#</a> 硬链接与软链接的联系与区别</h1> <p>我们知道文件都有文件名与数据，这在 Linux 上被分成两个部分：用户数据 (user data) 与元数据 (metadata)。
用户数据，即文件数据块 (data block)，数据块是记录文件真实内容的地方；
而元数据则是文件的附加属性，如文件大小、创建时间、所有者等信息。
在 Linux 中，元数据中的 inode 号（inode 是文件元数据的一部分但其并不包含文件名，inode 号即索引节点号）才是文件的唯一标识而非文件名。文件名仅是为了方便人们的记忆和使用，系统或程序通过 inode 号寻找正确的文件数据块。图 1.展示了程序通过文件名获取文件内容的过程。
<img src="data:image/jpeg;base64,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" alt="图 1. 通过文件名打开文件">
图 1. 通过文件名打开文件</p> <p>清单 3. 移动或重命名文件</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># stat /home/harris/source/glibc-2.16.0.tar.xz</span>
  File: `/home/harris/source/glibc-2.16.0.tar.xz'
  Size: 9990512      Blocks: 19520      IO Block: 4096   regular <span class="token function">file</span>
Device: 807h/2055d    Inode: 2485677     Links: 1
Access: <span class="token punctuation">(</span>0600/-rw-------<span class="token punctuation">)</span>  Uid: <span class="token punctuation">(</span> 1000/  harris<span class="token punctuation">)</span>   Gid: <span class="token punctuation">(</span> 1000/  harris<span class="token punctuation">)</span>
<span class="token punctuation">..</span>.
<span class="token punctuation">..</span>.
<span class="token comment"># mv /home/harris/source/glibc-2.16.0.tar.xz /home/harris/Desktop/glibc.tar.xz</span>
<span class="token comment"># ls -i -F /home/harris/Desktop/glibc.tar.xz</span>
2485677 /home/harris/Desktop/glibc.tar.xz
</code></pre></div><p>在 Linux 系统中查看 inode 号可使用命令 <code>stat</code> 或 <code>ls -i</code>（若是 AIX 系统，则使用命令 <code>istat</code>）。清单 3.中使用命令 <code>mv</code> 移动并重命名文件 glibc-2.16.0.tar.xz，其结果不影响文件的用户数据及 inode 号，文件移动前后 inode 号均为：2485677。
为解决文件的共享使用，Linux 系统引入了两种链接：硬链接 (hard link) 与软链接（又称符号链接，即 soft link 或 symbolic link）。链接为 Linux 系统解决了文件的共享使用，还带来了隐藏文件路径、增加权限安全及节省存储等好处。若一个 inode 号对应多个文件名，则称这些文件为硬链接。换言之，硬链接就是同一个文件使用了多个别名（见 图 2.hard link 就是 file 的一个别名，他们有共同的 inode）。硬链接可由命令 link 或 ln 创建。如下是对文件 oldfile 创建硬链接。</p> <div class="language- extra-class"><pre class="language-text"><code>link oldfile newfile
ln oldfile newfile
</code></pre></div><p>由于硬链接是有着相同 inode 号仅文件名不同的文件，因此硬链接存在以下几点特性：</p> <ul><li>文件有相同的 inode 及 data block；</li> <li>只能对已存在的文件进行创建；</li> <li>不能交叉文件系统进行硬链接的创建；</li> <li>不能对目录进行创建，只可对文件创建；</li> <li>删除一个硬链接文件并不影响其他有相同 inode 号的文件。</li> <li></li></ul> <p>清单 4. 硬链接特性展示</p> <div class="language- extra-class"><pre class="language-text"><code># ls -li
total 0
// 只能对已存在的文件创建硬连接
# link old.file hard.link
link: cannot create link `hard.link' to `old.file': No such file or directory
# echo &quot;This is an original file&quot; &gt; old.file
# cat old.file
This is an original file
# stat old.file
  File: `old.file'
  Size: 25           Blocks: 8          IO Block: 4096   regular file
Device: 807h/2055d    Inode: 660650      Links: 2
Access: (0644/-rw-r--r--)  Uid: (    0/    root)   Gid: (    0/    root)
...
// 文件有相同的 inode 号以及 data block
# link old.file hard.link | ls -li
total 8
660650 -rw-r--r-- 2 root root 25 Sep  1 17:44 hard.link
660650 -rw-r--r-- 2 root root 25 Sep  1 17:44 old.file

// 不能交叉文件系统
# ln /dev/input/event5 /root/bfile.txt
ln: failed to create hard link `/root/bfile.txt' =&gt; `/dev/input/event5':
Invalid cross-device link

// 不能对目录进行创建硬连接
# mkdir -p old.dir/test
# ln old.dir/ hardlink.dir
ln: `old.dir/': hard link not allowed for directory
# ls -iF
660650 hard.link  657948 old.dir/  660650 old.file
</code></pre></div><p>文件 old.file 与 hard.link 有着相同的 inode 号：660650 及文件权限，inode 是随着文件的存在而存在，因此只有当文件存在时才可创建硬链接，即当 inode 存在且链接计数器（link count）不为 0 时。inode 号仅在各文件系统下是唯一的，当 Linux 挂载多个文件系统后将出现 inode 号重复的现象（如 清单 5.所示，文件 t3.jpg、sync 及 123.txt 并无关联，却有着相同的 inode 号），因此硬链接创建时不可跨文件系统。设备文件目录 /dev 使用的文件系统是 devtmpfs，而 /root（与根目录 / 一致）使用的是磁盘文件系统 ext4。清单 5.展示了使用命令 df 查看当前系统中挂载的文件系统类型、各文件系统 inode 使用情况及文件系统挂载点。</p> <p>清单 5. 查找有相同 inode 号的文件</p> <div class="language- extra-class"><pre class="language-text"><code> # df -i --print-type
 Filesystem     Type       Inodes  IUsed    IFree IUse% Mounted on
 /dev/sda7      ext4      3147760 283483  2864277   10% /
 udev           devtmpfs   496088    553   495535    1% /dev
 tmpfs          tmpfs      499006    491   498515    1% /run
 none           tmpfs      499006      3   499003    1% /run/lock
 none           tmpfs      499006     15   498991    1% /run/shm
 /dev/sda6      fuseblk  74383900   4786 74379114    1% /media/DiskE
 /dev/sda8      fuseblk  29524592  19939 29504653    1% /media/DiskF

 # find / -inum 1114
 /media/DiskE/Pictures/t3.jpg
 /media/DiskF/123.txt
 /bin/sync
</code></pre></div><p>值得一提的是，Linux 系统存在 inode 号被用完但磁盘空间还有剩余的情况。我们创建一个 5M 大小的 ext4 类型的 mo.img 文件，并将其挂载至目录 /mnt。然后我们使用一个 shell 脚本将挂载在 /mnt 下 ext4 文件系统的 indoe 耗尽（见清单 6.）。
清单 6. 测试文件系统 inode 耗尽但仍有磁盘空间的情景</p> <div class="language- extra-class"><pre class="language-text"><code> # dd if=/dev/zero of=mo.img bs=5120k count=1
 # ls -lh mo.img
 -rw-r--r-- 1 root root 5.0M Sep  1 17:54 mo.img
 # mkfs -t ext4  -F ./mo.img
 ...
 OS type: Linux
 Block size=1024 (log=0)
 Fragment size=1024 (log=0)
 Stride=0 blocks, Stripe width=0 blocks
 1280 inodes, 5120 blocks
 256 blocks (5.00%) reserved for the super user
 ...
 ...
 Writing superblocks and filesystem accounting information: done

 # mount -o loop ./mo.img /mnt
 # cat /mnt/inode_test.sh
 #!/bin/bash

 for ((i = 1; ; i++))
 do
    if [ $? -eq 0 ]; then
        echo  &quot;This is file_$i&quot; &gt; file_$i
    else
        exit 0
    fi
 done

 # ./inode_test.sh
 ./inode_test.sh: line 6: file_1269: No space left on device

 # df -iT /mnt/; du -sh /mnt/
 Filesystem     Type Inodes IUsed IFree IUse% Mounted on
 /dev/loop0     ext4   1280  1280     0  100% /mnt
 1.3M    /mnt/
</code></pre></div><p>硬链接不能对目录创建是受限于文件系统的设计（见 清单 4.对目录创建硬链接将失败）。现 Linux 文件系统中的目录均隐藏了两个个特殊的目录：当前目录（.）与父目录（..）。查看这两个特殊目录的 inode 号可知其实这两目录就是两个硬链接（注意目录 /mnt/lost+found/ 的 inode 号）。若系统允许对目录创建硬链接，则会产生目录环。</p> <div class="language- extra-class"><pre class="language-text"><code># ls -aliF /mnt/lost+found
total 44
 11 drwx------ 2 root root 12288 Sep  1 17:54 ./
 2 drwxr-xr-x 3 root root 31744 Sep  1 17:57 ../

 # stat  /mnt/lost+found/
  File: `/mnt/lost+found/'
  Size: 12288        Blocks: 24         IO Block: 1024   directory
 Device: 700h/1792d    Inode: 11          Links: 2
 Access: (0700/drwx------)  Uid: (    0/    root)   Gid: (    0/    root)
 Access: 2012-09-01 17:57:17.000000000 +0800
 Modify: 2012-09-01 17:54:49.000000000 +0800
 Change: 2012-09-01 17:54:49.000000000 +0800
 Birth: -
</code></pre></div><p>软链接与硬链接不同，若文件用户数据块中存放的内容是另一文件的路径名的指向，则该文件就是软连接。软链接就是一个普通文件，只是数据块内容有点特殊。软链接有着自己的 inode 号以及用户数据块（见 图 2.）。因此软链接的创建与使用没有类似硬链接的诸多限制：</p> <ul><li>软链接有自己的文件属性及权限等；</li> <li>可对不存在的文件或目录创建软链接；</li> <li>软链接可交叉文件系统；</li> <li>软链接可对文件或目录创建；</li> <li>创建软链接时，链接计数 i_nlink 不会增加；</li> <li>删除软链接并不影响被指向的文件，但若被指向的原文件被删除，则相关软连接被称为死链接（即 dangling link，若被指向路径文件被重新创建，死链接可恢复为正常的软链接）。</li></ul> <p><img src="data:image/jpeg;base64,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" alt="图 2. 软链接的访问">
图 2. 软链接的访问
清单 7. 软链接特性展示</p> <div class="language- extra-class"><pre class="language-text"><code> # ls -li
 total 0

 // 可对不存在的文件创建软链接
 # ln -s old.file soft.link
 # ls -liF
 total 0
 789467 lrwxrwxrwx 1 root root 8 Sep  1 18:00 soft.link -&gt; old.file

 // 由于被指向的文件不存在，此时的软链接 soft.link 就是死链接
 # cat soft.link
 cat: soft.link: No such file or directory

 // 创建被指向的文件 old.file，soft.link 恢复成正常的软链接
 # echo &quot;This is an original file_A&quot; &gt;&gt; old.file
 # cat soft.link
 This is an original file_A

 // 对不存在的目录创建软链接
 # ln -s old.dir soft.link.dir
 # mkdir -p old.dir/test
 # tree . -F --inodes
 .
├── [ 789497]  old.dir/
│   └── [ 789498]  test/
├── [ 789495]  old.file
├── [ 789495]  soft.link -&gt; old.file
└── [ 789497]  soft.link.dir -&gt; old.dir/
</code></pre></div><p>当然软链接的用户数据也可以是另一个软链接的路径，其解析过程是递归的。但需注意：软链接创建时原文件的路径指向使用绝对路径较好。使用相对路径创建的软链接被移动后该软链接文件将成为一个死链接（如下所示的软链接 a 使用了相对路径，因此不宜被移动），因为链接数据块中记录的亦是相对路径指向。</p> <div class="language- extra-class"><pre class="language-text"><code> $ ls -li
 total 2136
 656627 lrwxrwxrwx 1 harris harris       8 Sep  1 14:37 a -&gt; data.txt
 656662 lrwxrwxrwx 1 harris harris       1 Sep  1 14:37 b -&gt; a
 656228 -rw------- 1 harris harris 2186738 Sep  1 14:37 data.txt 6
</code></pre></div><p>链接相关命令
在 Linux 中查看当前系统已挂着的文件系统类型，除上述使用的命令 <code>df</code>，还可使用命令 <code>mount</code> 或查看文件 <code>/proc/mounts</code>。</p> <div class="language- extra-class"><pre class="language-text"><code> # mount
 /dev/sda7 on / type ext4 (rw,errors=remount-ro)
 proc on /proc type proc (rw,noexec,nosuid,nodev)
 sysfs on /sys type sysfs (rw,noexec,nosuid,nodev)
 ...
 ...
 none on /run/shm type tmpfs (rw,nosuid,nodev)
</code></pre></div><p>命令 <code>ls</code> 或 <code>stat</code> 可帮助我们区分软链接与其他文件并查看文件 inode 号，但较好的方式还是使用 <code>find</code> 命令，其不仅可查找某文件的软链接，还可以用于查找相同 inode 的所有硬链接。（见清单 8.）
清单 8. 使用命令 <code>find</code> 查找软链接与硬链接</p> <div class="language- extra-class"><pre class="language-text"><code> // 查找在路径 /home 下的文件 data.txt 的软链接
 # find /home -lname data.txt
 /home/harris/debug/test2/a

 // 查看路径 /home 有相同 inode 的所有硬链接
 # find /home -samefile /home/harris/debug/test3/old.file
 /home/harris/debug/test3/hard.link
 /home/harris/debug/test3/old.file

 # find /home -inum 660650
 /home/harris/debug/test3/hard.link
 /home/harris/debug/test3/old.file

 // 列出路径 /home/harris/debug/ 下的所有软链接文件
 # find /home/harris/debug/ -type l -ls
 656662 0 lrwxrwxrwx 1 harris harris 1 Sep 1 14:37 /home/harris/debug/test2/b -&gt; a
 656627 0 lrwxrwxrwx 1 harris harris 8 Sep 1 14:37 /home/harris/debug/test2/a -&gt;
 data.txt
 789467 0 lrwxrwxrwx 1 root root 8 Sep 1 18:00 /home/harris/debug/test/soft.link -&gt;
 old.file
 789496    0 lrwxrwxrwx   1 root     root            7 Sep  1 18:01
 /home/harris/debug/test/soft.link.dir -&gt; old.dir
</code></pre></div><p>系统根据磁盘的大小默认设定了 inode 的值（见清单 9.），如若必要，可在格式文件系统前对该值进行修改。如键入命令 mkfs -t ext4 -I 512/dev/sda4，将使磁盘设备 /dev/sda4 格式成 inode 大小是 512 字节的 ext4 文件系统。
清单 9. 查看系统的 inode 值</p> <div class="language- extra-class"><pre class="language-text"><code> // 查看磁盘分区 /dev/sda7 上的 inode 值
 # dumpe2fs -h /dev/sda7 | grep &quot;Inode size&quot;
 dumpe2fs 1.42 (29-Nov-2011)
 Inode size:             256

 # tune2fs -l /dev/sda7 | grep &quot;Inode size&quot;
 Inode size:             256
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/17.51e61b79.js" defer></script><script src="/assets/js/app.5770203f.js" defer></script>
  </body>
</html>
